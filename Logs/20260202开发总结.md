#  Project Anla 完整研发全景报告

**项目名称**：Project Anla (Native Complex-Valued Dynamical Neural Networks)
**报告日期**：2026年2月3日
**最终状态**：**核心引擎验证通过 $\to$ 系统物理自洽 $\to$ 100% 收敛**
**硬件环境**：NVIDIA RTX 5070 (Manual Backward Enabled)

---

##  阶段一：核心引擎设计与验证 (Kernel Verification)

此阶段致力于解决复数神经网络底层的数学悖论，确立了单个神经元的计算逻辑。

### 1.1 理论设计挑战与突破

* **梯度优化 (Wirtinger Calculus)**：

  * **问题**：Loss 函数是实值函数，不满足全纯性（Cauchy-Riemann 方程），标准复数求导无效。
  * **方案**：采用 **Wirtinger 微积分**，将 $z$ 和 $z^*$ 视为独立变量，定义反向传播方向为 $\frac{\partial L}{\partial z^*}$（共轭导数）。
* **激活函数 (PhaseTwist)**：

  * **问题**：Liouville 定理限制了全纯且有界的非线性函数存在。
  * **方案**：放弃全纯性，设计 **相位-模长耦合** 机制。
  * **公式**：$f(z) = \tanh(|z|) \cdot e^{i(\theta + \gamma \cdot |z|)}$
  * **原理**：利用 $\gamma$ 参数，根据信号强度扭曲流形，实现非线性拓扑切割。
* **归一化 (ComplexRMSNorm)**：

  * **方案**：设计了基于能量锚定的归一化层，强制将信号约束在单位超球面上，防止复数乘法导致的指数级发散。

### 1.2 关键实验成果

* **流形逼近 ($z \to z^2$)**：成功拟合频率倍增映射，证明网络具备连续非线性能力。
* **逻辑分类 (XOR)**：收敛至 100% 准确率。决策边界呈现清晰的 **“棋盘格 (Checkerboard)”** 形状，证明相位逻辑可有效解决线性不可分问题。

---

##  阶段二：Transformer 集成、物理修正与终极优化 (Integration, Debugging & Optimization)

此阶段将神经元组装成 Transformer，并经历了从“代码崩溃”到“物理自洽”的深度演进。

### 2.1 遇到的困难与物理修正 (Troubleshooting Log)

####  困难 1：动力学逆转 (Kinetic Reversal) —— 解决 NaN

* **现象**：集成初期，Loss 指数级爆炸并迅速变成 `NaN`。
* **根源**：底层 `ComplexLinear` 默认沿用了 **赫布规则 (Hebbian Rule)** ($W += \eta \cdot \nabla$)。这是一种正反馈（能量泵浦），与 Transformer 最小化误差的目标（负反馈）冲突。
* **解决方案**：**物理模式开关**。在 Transformer 中强制启用 `mode='descent'` (纠错模式， $W -= \eta \cdot \nabla$)。

####  困难 2：能量约束 (Energy Constraint) —— 解决 Embedding 发散

* **现象**：Embedding 层参数无限膨胀。
* **根源**：复数注意力包含二次项 ($Q \cdot K^H$)，输入模长的微小增加会被平方级放大。
* **解决方案**：**流形约束 (Manifold Constraint)**。

  * 在反向传播中，每次更新后强制执行：`weight = weight / |weight|`。
  * **意义**：锁死模长，迫使网络放弃“用蛮力喊话”，转而学习精细的相位编码。

####  困难 3：深层稳健性 (Stability at Depth) —— 解决深层梯度爆炸

* **现象**：网络加深、维度升至 128 时再次不稳定。
* **解决方案**：**自适应物理阻尼器 (Adaptive Physical Damping)**。

  * 引入 **“静止质量” (Rest Mass = $1e-3$)** 防止冷启动时的除零飞逸。
  * 引入 **“低惯性” ($\beta = 0.90$)** 确保系统对 Warmup 结束后的相变做出毫秒级响应。

####  困难 4：算力冲突 —— 解决 Autograd 报错

* **现象**：RTX 5070 上 PyTorch Autograd 不支持复杂的复数手动微分逻辑。
* **解决方案**：**全手动微分 (Manual Backward)**。显式关闭计算图，利用 `register_buffer` 管理状态，大幅降低显存开销。

### 2.2 终极突破：打破 78% 天花板

* **瓶颈**：模型稳定但准确率卡在 78%。热力图显示“马尔可夫歧义”（模型无法区分不同位置的相同 Token，相位发生混叠）。
* **突破口**：**复数旋转位置编码 (Complex Rotary Embedding)**。

  * **机制**：给每个 Token 挂上不同频率的“时钟” ($\theta + \omega t$)。
  * **结果**：将语义向量在希尔伯特空间中正交化，**准确率最终突破至 100%**。

---

##  阶段三：最终技术架构与设计哲学 (Final Design & Philosophy)

### 3.1 核心组件规范

| 组件                         | 关键特性                     | 物理原理                         |      |                    |
| :------------------------- | :----------------------- | :--------------------------- | ---- | ------------------ |
| **ComplexEmbedding**       | **流形约束** ($              | z                            | =1$) | 定义系统的能量边界；强制纯相位编码。 |
| **ComplexRotaryEmbedding** | **纯相位旋转**                | 将时序 $t$ 转化为波函数相位偏移，实现全息位置感知。 |      |                    |
| **HolographicAttention**   | **共轭干涉** ($Q \cdot K^H$) | 通过相长/相消干涉实现信息的全息检索。          |      |                    |
| **ComplexLinear**          | **自适应阻尼**                | 模拟变粘度流体，自动调节梯度步长。            |      |                    |
| **PhaseTwist**             | **相位-模长耦合**              | 引入非线性流形扭曲，实现逻辑分类。            |      |                    |

### 3.2 沉淀出的三大设计原理

1. **几何优于工程 (Geometry over Engineering)**

   * 拒绝粗暴的“梯度裁剪”，而是通过 **流形投影 (Retraction)** 将参数约束在单位圆上。这是对复数几何本质的尊重。

2. **动力学优于静态图 (Dynamics over Statics)**

   * 系统稳定性依赖于 **能量守恒**（流形约束）和 **能量耗散**（Weight Decay）。
   * 必须处理好 **启动瞬态**（Rest Mass），防止系统在稳态建立前崩溃。

3. **全息优于聚焦 (Holography over Focus)**

   * Anla 不追求 Attention Map 上的“单点聚焦”，而是依赖 **分布式干涉**。即使热力图模糊，只要全场相位对齐，信息就能被精准还原。

---

### 结语

Project Anla 的成功在于我们没有将神经网络视为黑盒，而是将其视为一个**物理系统**。从解决 Wirtinger 导数的数学定义，到处理 Transformer 内部的能量流，再到利用相位旋转解决时空歧义，每一步都是物理直觉与数学严谨性的结合。

---
# **信息是波，计算是干涉，记忆是旋转，智能是相位锁定。**
